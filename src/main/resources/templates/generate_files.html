<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/styles.css}" href="../static/css/styles.css" />
    <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/style1.css}" href="../static/css/style1.css" />
    <style>
        /* Add styling for the loader */
        #loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
            margin-top: 40px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
<div id="header">
    <img th:src="@{/images/logo.png}" src="../static/images/logo.png" alt="Your Logo">
</div>
<div id="content4">
    <h1>Seamless CICs Compliance:<br>
        Precision in Every Submission File</h1>
    <p>Efficiently organize bank data to meet CICs standards by dividing it into utility<br>
        tables. This systematic division ensures seamless compliance and facilitates<br>
        streamlined access for optimal reporting and analysis. Enhance data<br>
        organization and responsiveness to regulatory requirements with our tailored<br>
        utility table structure.</p>
</div>
<div class="ButtonContainer">
    <button onclick="runJar()" class="runJar">Transactional Files</button>
    <button onclick="runJarBackup()" class="runJarBackup">Complete Files</button>
    <button onclick="openAnotherPage()" class="openPage">Upload New csv</button>
    <div>
        <form th:action="@{/call-procedures}" method="post">
            <button type="submit" class="reportbutton">Management Report</button>
        </form>
    </div>
    <div>
        <form id="reportForm" action="/home" method="post">
            <button id="submitButton" type="submit" class="dqi_button">DQI Report</button>
        </form>
    </div>
    <div>
        <button onclick="tudfToExcel()" class="tudf_button">TUDF To Excel</button>
    </div>

</div>
<div class="GenerateReportButton">
    <a href="#" onclick="generateReport(); return false;" class="generateReport" style="display: none">Generate Report >></a>
</div>



<div th:if="${successMessage}" class="success-message">
    <p th:text="${successMessage}"></p>
    <script>
        setTimeout(function() {
            window.location.href = '/report'; // Redirect to report.html after 3 seconds
        }, 2000); // Adjust the delay time as needed
    </script>
</div>

<div th:if="${successMessage}" class="success-message">
    <p th:text="${successMessage}"></p>
    <script>
        setTimeout(function() {
            window.location.href = '/home';
        }, 2000);
    </script>
</div>

<!-- Display error message if present -->
<div th:if="${errorMessage}" class="error-message">
    <p th:text="${errorMessage}"></p>
</div>

<!--
<a class="openPage" th:href="@{/csv_to_db}">Upload New csv</a>
-->

<!-- Div for success or error message -->
<div id="message" style="position: fixed; bottom: 0; left: 0; width: 100%; background-color:none ; color:#FFFFFF; text-align: center; padding: 10px; font-size: 20px;"></div>

<!-- Loader -->
<div id="loader" style="display: none;"></div>

<script>
    function tudfToExcel(){
       // Open another page when the button is clicked
        window.location.href = '/tudf_to_excel';
   }

    document.getElementById('submitButton').addEventListener('click', function(event) {
    // Prevent the default form submission behavior
    event.preventDefault();

    // Display loader
    document.getElementById('loader').style.display = 'block';

    // Simulate processing delay
    setTimeout(function() {
        // Hide loader
        document.getElementById('loader').style.display = 'none';

        // Make AJAX request to fetch message from backend
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/getMessage', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // Display message received from backend
                document.getElementById('message').innerText = xhr.responseText;
                document.getElementById('message').style.display = 'block';

                // Redirect to /home after 5 seconds
                setTimeout(function() {
                    window.location.href = '/home';
                }, 5000); // Adjust the delay before redirection (5 seconds)
            }
        };
        xhr.send();
    }, 3000); // Simulate processing time (3 seconds)
});




    function openAnotherPage() {
       // Open another page when the button is clicked
       window.location.href = 'csv_to_db';
   }
      function runJar() {
        // Display loader
        document.getElementById('loader').style.display = 'block';

        // Send an HTTP request to the server to run the JAR file
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/api/run-jar', true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                // Hide the loader
                document.getElementById('loader').style.display = 'none';

                if (xhr.status === 200) {
                    // Display the result from the server in the 'message' div
                    document.getElementById('message').innerHTML = xhr.responseText;
                    // Show the "Generate Report" button
                    document.querySelector('.generateReport').style.display = 'block';
                } else {
                    // Display an error message in the 'message' div
                    document.getElementById('message').innerHTML = 'Error: ' + xhr.responseText;
                }
            }
        };
        xhr.send();
    }

    function runJarBackup() {
        // Display loader
        document.getElementById('loader').style.display = 'block';

        // Send an HTTP request to the server to run the JAR file
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/api/run-jar-backup', true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                // Hide the loader
                document.getElementById('loader').style.display = 'none';

                if (xhr.status === 200) {
                    // Display the result from the server in the 'message' div
                    document.getElementById('message').innerHTML = xhr.responseText;
                    // Show the "Generate Report" button
                    document.querySelector('.generateReport').style.display = 'block';
                } else {
                    // Display an error message in the 'message' div
                    document.getElementById('message').innerHTML = 'Error: ' + xhr.responseText;
                }
            }
        };
        xhr.send();
    }

   function generateReport() {
    // Display loader
    document.getElementById('loader').style.display = 'block';

    // Send an HTTP request to the server to generate the report
    var xhr = new XMLHttpRequest();
    xhr.open('GET', '/generateReport', true);
    xhr.responseType = 'blob'; // Set response type to Blob

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            // Hide the loader
            document.getElementById('loader').style.display = 'none';

            if (xhr.status === 200) {
                // Create a Blob from the response
                var blob = new Blob([xhr.response], { type: 'text/csv' });

                // Create an anchor element
                var a = document.createElement('a');
                // Set the href attribute to the URL of the Blob
                a.href = window.URL.createObjectURL(blob);

                // Get current date and time
                var currentDate = new Date();
                var formattedDate = currentDate.toISOString().slice(0,10);
                var formattedTime = currentDate.toTimeString().slice(0,8).replace(/:/g, "-");

                // Set the download attribute to include date and time in the filename
                a.download = 'status_report_' + formattedDate + '_' + formattedTime + '.csv';

                // Click the anchor element to trigger the download
                a.click();
                // Release the URL object to free up resources
                window.URL.revokeObjectURL(a.href);

                // Display success message
                document.getElementById('message').innerHTML = 'Status Report Downloaded successfully!';
            } else {
                // Display an error message on the screen
                document.getElementById('message').innerHTML = 'Error: Failed to generate report. Please try again.';
            }
        }
    };
    xhr.send();
}

</script>
</body>
</html>

